import{e as L,i as v,h as k,j as w}from"./elements-1fb47fa1.js";import{ax as I,aM as d}from"./vue-router-547718df.js";import{a as b}from"./logger-9a144f5d.js";const O="background-image",R="lazy-loading",W="lazy-error",m="lazy-attempt",C=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],u="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",n=[],s=[],y=w(100),e={loading:u,error:u,attempt:3,throttleWait:300,events:C};let A=d(o,e.throttleWait);function c(t,a){t._lazy.arg===O?t.style.backgroundImage=`url(${a})`:t.setAttribute("src",a)}function G(t){t._lazy.loading&&c(t,t._lazy.loading),o()}function N(t){t._lazy.error&&c(t,t._lazy.error),t._lazy.state="error",f(t),o()}function z(t,a){c(t,a),t._lazy.state="success",f(t),o()}function B(t){var a;s.includes(t)||(s.push(t),(a=e.events)==null||a.forEach(r=>{t.addEventListener(r,A,{passive:!0})}))}function M(){s.forEach(t=>{var a;(a=e.events)==null||a.forEach(r=>{t.removeEventListener(r,A)})}),s.length=0}function P(t,a){const r={loading:t.getAttribute(R)??e.loading,error:t.getAttribute(W)??e.error,attempt:t.getAttribute(m)?Number(t.getAttribute(m)):e.attempt};t._lazy={src:a.value,arg:a.arg,currentAttempt:0,state:"pending",attemptLock:!1,...r},c(t,u),b(e.filter,t._lazy)}function T(t,a){const r=new Image;r.src=a,t._lazy.preloadImage=r,r.addEventListener("load",()=>{t._lazy.attemptLock=!1,y.add(a),z(t,a)}),r.addEventListener("error",()=>{t._lazy.attemptLock=!1,t._lazy.currentAttempt>=t._lazy.attempt?N(t):g(t)})}function g(t){if(t._lazy.attemptLock)return;t._lazy.attemptLock=!0,t._lazy.currentAttempt++;const{src:a}=t._lazy;if(y.has(a)){z(t,a),t._lazy.attemptLock=!1;return}G(t),T(t,a)}async function l(t){await L(),v(t)&&g(t)}function o(){n.forEach(t=>l(t))}async function D(t){!n.includes(t)&&n.push(t),k(t).forEach(B),await l(t)}function f(t){I(n,t),n.length===0&&M()}function S(t,a){const{src:r,arg:i}=t._lazy;return r!==a.value||i!==a.arg}async function p(t,a){P(t,a),await D(t)}async function Y(t,a){if(!S(t,a)){n.includes(t)&&await l(t);return}await p(t,a)}function Z(t={}){const{events:a,loading:r,error:i,attempt:h,throttleWait:_,filter:E}=t;e.events=a??e.events,e.loading=r??e.loading,e.error=i??e.error,e.attempt=h??e.attempt,e.throttleWait=_??e.throttleWait,e.filter=E}const x={mounted:p,unmounted:f,updated:Y,install(t,a){Z(a),A=d(o,e.throttleWait),t.directive("lazy",this)}},K=x;export{K as v};
