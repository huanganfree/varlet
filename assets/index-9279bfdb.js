import{p as we,S as ge}from"./index-48bd5f24.js";import{S as Te}from"./index-5d1f4666.js";import{I as Ce}from"./index-d9f34410.js";import{p as Ie,P as Se}from"./index-3494baee.js";import{d as Oe,r as d,b5 as Pe,D as W,a4 as b,a7 as De,G as ye,aD as H,aO as Re,_ as ke,b as k,e as S,f as A,w as N,q as Ne,as as $e,m as q,N as ze,O as Le,x as h,p as E,y as be,v as V,R as G,t as Z,af as Ae,W as Ee,n as Ve,ac as Be,a2 as Ye}from"./index-ba2bae36.js";import{d as j,p as J,c as Fe,a as O,m as Ue,w as x}from"./components-b4bea23d.js";const Xe={show:Boolean,imagePreventDefault:Boolean,images:{type:Array,default:()=>[]},current:String,initialIndex:{type:[String,Number],default:0},zoom:{type:[String,Number],default:2},closeable:Boolean,"onUpdate:show":j(),onLongPress:j(),...J(we,["loop","indicator","onChange"]),...J(Ie,["lockScroll","teleport","onOpen","onClose","onOpened","onClosed","onRouteChange"])},{name:Me,n:K,classes:We}=Fe("image-preview"),B=12,Q=200,He=350,_=200,qe=500,Ge=Oe({name:Me,components:{VarSwipe:ge,VarSwipeItem:Te,VarPopup:Se,VarIcon:Ce},inheritAttrs:!1,props:Xe,setup(e){const i=d(!1),a=d(1),u=d(0),f=d(0),D=d(),T=d(),C=d(!0),w=d(null),{moveX:z,moveY:c,distance:m,startTime:r,startTouch:ee,moveTouch:ne,endTouch:Y}=Pe(),oe=W(()=>{const{images:n,current:o,initialIndex:t}=e;if(t!=null)return b(t);const l=n.findIndex(p=>p===o);return Math.max(l,0)}),te=W(()=>{const{imagePreventDefault:n,show:o}=e;return o&&n});let F=null,I=null,y=!1;const s={start:null,prev:null};De(()=>document,"contextmenu",he),ye(()=>e.show,n=>{i.value=n},{immediate:!0});function ae(){a.value=b(e.zoom),C.value=!1,s.prev=null,window.setTimeout(()=>{D.value="linear",T.value="0s"},_)}function U(){a.value=1,u.value=0,f.value=0,C.value=!0,s.prev=null,D.value=void 0,T.value=void 0}function se(n){return s.prev?m.value<=B&&performance.now()-r.value<=Q&&s.prev===n:!1}function ie(n){return!n||!s.start||!s.prev?!1:m.value<=B&&performance.now()-r.value<He&&(n===s.start||n.parentNode===s.start)}function re(){Y(),window.clearTimeout(I),y=!1,s.start=null}function le(n){if(Y(),window.clearTimeout(I),y){y=!1;return}const o=ie(n.target);F=window.setTimeout(()=>{o&&M(),s.start=null},Q)}function ue(n,o){window.clearTimeout(F),window.clearTimeout(I);const t=n.currentTarget;if(s.start=t,I=window.setTimeout(()=>{y=!0,O(e.onLongPress,o)},qe),se(t)){a.value>1?U():ae();return}ee(n),s.prev=t}function X(n){const{offsetWidth:o,offsetHeight:t}=n,{naturalWidth:l,naturalHeight:p}=n.querySelector(`.${K("image")}`);return{width:o,height:t,imageRadio:p/l,rootRadio:t/o,zoom:b(e.zoom)}}function ce(n){const{zoom:o,imageRadio:t,rootRadio:l,width:p,height:R}=X(n);if(!t)return 0;const L=t>l?R/t:p;return Math.max(0,(o*L-p)/2)/o}function me(n){const{zoom:o,imageRadio:t,rootRadio:l,width:p,height:R}=X(n);if(!t)return 0;const L=t>l?R:p*t;return Math.max(0,(o*L-R)/2)/o}function pe(n){if(!s.prev)return;ne(n);const o=n.currentTarget;if(m.value>B&&window.clearTimeout(I),a.value>1){const t=ce(o),l=me(o);u.value=H(u.value+z.value,-t,t),f.value=H(f.value+c.value,-l,l)}s.prev=o}function M(){if(a.value>1){U(),setTimeout(()=>O(e["onUpdate:show"],!1),_);return}O(e["onUpdate:show"],!1)}function de(n){var o;(o=w.value)==null||o.prev(n)}function ve(n){var o;(o=w.value)==null||o.next(n)}function fe(n,o){var t;(t=w.value)==null||t.to(n,o)}function he(n){e.imagePreventDefault&&e.show&&Re(n)}return{swipeRef:w,isPreventDefault:te,initialIndex:oe,popupShow:i,scale:a,translateX:u,translateY:f,canSwipe:C,transitionTimingFunction:D,transitionDuration:T,n:K,classes:We,handleTouchstart:ue,handleTouchmove:pe,handleTouchend:le,handleTouchcancel:re,close:M,prev:de,next:ve,to:fe}}});const Ze=["onTouchstart"],je=["src","alt"];function Je(e,i,a,u,f,D){const T=k("var-swipe-item"),C=k("var-swipe"),w=k("var-icon"),z=k("var-popup");return S(),A(z,{class:h(e.n("popup")),"var-image-preview-cover":"",transition:e.n("$-fade"),show:e.popupShow,overlay:!1,"close-on-click-overlay":!1,"lock-scroll":e.lockScroll,teleport:e.teleport,onOpen:e.onOpen,onClose:e.onClose,onClosed:e.onClosed,onOpened:e.onOpened,onRouteChange:e.onRouteChange},{default:N(()=>[Ne(C,$e({ref:"swipeRef",class:e.n("swipe"),"var-image-preview-cover":"",touchable:e.canSwipe,indicator:e.indicator&&e.images.length>1,"initial-index":e.initialIndex,loop:e.loop,onChange:e.onChange},e.$attrs),{default:N(()=>[(S(!0),q(ze,null,Le(e.images,(c,m)=>(S(),A(T,{class:h(e.n("swipe-item")),"var-image-preview-cover":"",key:c},{default:N(()=>[E("div",{class:h(e.n("zoom-container")),style:be({transform:`scale(${e.scale}) translate(${e.translateX}px, ${e.translateY}px)`,transitionTimingFunction:e.transitionTimingFunction,transitionDuration:e.transitionDuration}),onTouchstart:r=>e.handleTouchstart(r,m),onTouchmove:i[0]||(i[0]=(...r)=>e.handleTouchmove&&e.handleTouchmove(...r)),onTouchend:i[1]||(i[1]=(...r)=>e.handleTouchend&&e.handleTouchend(...r)),onTouchcancel:i[2]||(i[2]=(...r)=>e.handleTouchcancel&&e.handleTouchcancel(...r))},[E("img",{class:h(e.classes(e.n("image"),[e.isPreventDefault,e.n("--prevent")])),src:c,alt:c},null,10,je)],46,Ze)]),_:2},1032,["class"]))),128))]),indicator:N(({index:c,length:m})=>[V(e.$slots,"indicator",{index:c,length:m},()=>[e.indicator&&e.images.length>1?(S(),q("div",{key:0,class:h(e.n("indicators"))},G(c+1)+" / "+G(m),3)):Z("",!0)])]),_:3},16,["class","touchable","indicator","initial-index","loop","onChange"]),V(e.$slots,"close-icon",{},()=>[e.closeable?(S(),A(w,{key:0,class:h(e.n("close-icon")),name:"close-circle","var-image-preview-cover":"",onClick:e.close},null,8,["class","onClick"])):Z("",!0)]),E("div",{class:h(e.n("extra"))},[V(e.$slots,"extra")],2)]),_:3},8,["class","transition","show","lock-scroll","teleport","onOpen","onClose","onClosed","onOpened","onRouteChange"])}const $=ke(Ge,[["render",Je]]);let v,P={};function Ke(e={}){return Be(e)?{...P,images:[e]}:Ye(e)?{...P,images:e}:{...P,...e}}function g(e){if(!Ae())return;g.close();const i=Ke(e),a=Ee(i);a.teleport="body",v=a;const{unmountInstance:u}=Ue($,a,{onClose:()=>O(a.onClose),onClosed:()=>{O(a.onClosed),u(),v===a&&(v=null)},onRouteChange:()=>{u(),v===a&&(v=null)},"onUpdate:show":f=>{a.show=f}});a.show=!0}g.close=()=>{if(v!=null){const e=v;v=null,Ve().then(()=>{e.show=!1})}};g.setDefaultOptions=e=>{P=e};g.resetDefaultOptions=()=>{P={}};g.Component=$;x($);x($,g);export{g as I};
